@model IEnumerable<ProyectoLuisa.Models.Horario>

@{
    ViewData["Title"] = "Consulta de Horarios";
    var rol = Context.Session.GetString("Rol");
}

<h2 class="mb-4 text-center fw-bold text-primary">ðŸ•“ Consulta y GestiÃ³n de Horarios</h2>

<!-- ðŸ”¹ BotÃ³n de creaciÃ³n solo visible para Docente o Admin -->
@if (rol == "Docente" || rol == "Admin")
{
    <div class="mb-3 text-end">
        <a asp-action="Crear" class="btn btn-success shadow-sm">
            <i class="bi bi-plus-circle"></i> Nuevo Horario
        </a>
    </div>
}

<!-- ðŸ”¹ Filtros -->
<form method="get" class="row g-3 mb-4 bg-light p-3 rounded shadow-sm">
    <div class="col-md-3">
        <label class="form-label fw-semibold">DÃ­a de la Semana</label>
        <select name="dia" class="form-select">
            <option value="">Todos</option>
            <option value="Lunes">Lunes</option>
            <option value="Martes">Martes</option>
            <option value="MiÃ©rcoles">MiÃ©rcoles</option>
            <option value="Jueves">Jueves</option>
            <option value="Viernes">Viernes</option>
            <option value="SÃ¡bado">SÃ¡bado</option>
        </select>
    </div>

    <div class="col-md-3">
        <label class="form-label fw-semibold">Grupo</label>
        <input type="text" name="grupo" value="@Context.Request.Query["grupo"]"
               class="form-control" placeholder="Ej: A, B, C" />
    </div>

    <div class="col-md-3">
        <label class="form-label fw-semibold">Profesor</label>
        <input type="text" name="profesor" value="@Context.Request.Query["profesor"]"
               class="form-control" placeholder="Nombre del profesor" />
    </div>

    <div class="col-md-3 align-self-end">
        <button type="submit" class="btn btn-primary w-100 shadow-sm">
            <i class="bi bi-search"></i> Buscar
        </button>
    </div>
</form>

<!-- ðŸ”¹ Tabla -->
@if (Model != null && Model.Any())
{
    <div class="table-responsive shadow-sm">
        <table class="table table-striped table-hover align-middle text-center">
            <thead class="table-dark">
                <tr>
                    <th>Materia</th>
                    <th>DÃ­a</th>
                    <th>Hora Inicio</th>
                    <th>Hora Fin</th>
                    <th>Aula</th>
                    <th>Grupo</th>
                    <th>Profesor</th>
                    @if (rol == "Docente" || rol == "Admin")
                    {
                        <th>Acciones</th>
                    }
                </tr>
            </thead>
            <tbody>
                @foreach (var h in Model)
                {
                    <tr>
                        <td>@h.Materia</td>
                        <td>@h.DiaSemana</td>
                        <td>@h.HoraInicio.ToString(@"hh\:mm")</td>
                        <td>@h.HoraFin.ToString(@"hh\:mm")</td>
                        <td>@h.Aula</td>
                        <td>@h.Grupo</td>
                        <td>@h.Profesor</td>

                        @if (rol == "Docente" || rol == "Admin")
                        {
                            <td>
                                <a asp-action="Editar" asp-route-id="@h.Id" class="btn btn-sm btn-primary">
                                    <i class="bi bi-pencil"></i> Editar
                                </a>

                                <form asp-action="Eliminar" method="post" style="display:inline;">
                                    <input type="hidden" name="id" value="@h.Id" />
                                    <button type="submit" class="btn btn-sm btn-danger"
                                            onclick="return confirm('Â¿Seguro que deseas eliminar este horario?');">
                                        <i class="bi bi-trash"></i> Eliminar
                                    </button>
                                </form>
                            </td>
                        }
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
else
{
    <div class="alert alert-warning text-center mt-4">
        <i class="bi bi-exclamation-triangle"></i> No se encontraron horarios con los filtros seleccionados.
    </div>
}

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
