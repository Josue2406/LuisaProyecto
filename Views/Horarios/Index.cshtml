@model IEnumerable<ProyectoLuisa.Models.Horario>
@{
    ViewData["Title"] = "Horarios Escolares";
    var secciones = ViewBag.Secciones as List<string>;
    var seleccionada = ViewBag.SeccionSeleccionada as string;
}

<div class="container mt-4">
    <h2 class="text-center mb-4 text-success fw-bold">🕓 Horarios Escolares</h2>

    <!-- 🔹 Filtro por sección -->
    <form method="get" class="d-flex justify-content-center mb-4">
        <select name="seccion" class="form-select w-auto shadow-sm" onchange="this.form.submit()">
            <option value="">-- Seleccione una sección --</option>
            @foreach (var s in secciones)
            {
                <option value="@s" selected="@(s == seleccionada)">
                    @s
                </option>
            }
        </select>
    </form>

    <!-- 🔹 Botones CRUD (solo Docente/Admin) -->
    @if (Context.Session.GetString("Rol") == "Docente" || Context.Session.GetString("Rol") == "Admin")
    {
        <div class="d-flex justify-content-between mb-4">
            <a href="/Horarios/Crear" class="btn btn-success shadow-sm">
                <i class="bi bi-plus-lg"></i> Añadir Horario
            </a>
            <a href="/Docente/Inicio" class="btn btn-outline-secondary shadow-sm">
                <i class="bi bi-arrow-left"></i> Volver al panel
            </a>
        </div>
    }

    <!-- 🔹 Tabla de horarios -->
    @if (!Model.Any())
    {
        <div class="alert alert-info text-center shadow-sm">
            <i class="bi bi-calendar2-x"></i> No hay horarios registrados para esta sección.
        </div>
    }
    else
    {
        <div class="table-responsive shadow-sm rounded-3 overflow-hidden">
            <table class="table align-middle table-hover mb-0">
                <thead class="table-success">
                    <tr>
                        <th>Materia</th>
                        <th>Día</th>
                        <th>Inicio</th>
                        <th>Fin</th>
                        <th>Sección</th>
                        @if (Context.Session.GetString("Rol") == "Docente" || Context.Session.GetString("Rol") == "Admin")
                        {
                            <th>Acciones</th>
                        }
                    </tr>
                </thead>
                <tbody>
                    @foreach (var h in Model)
                    {
                        var diaClase = h.DiaSemana.ToLower();
                        var diaColor = diaClase switch
                        {
                            "lunes" => "bg-lunes",
                            "martes" => "bg-martes",
                            "miércoles" or "miercoles" => "bg-miercoles",
                            "jueves" => "bg-jueves",
                            "viernes" => "bg-viernes",
                            _ => "bg-otro"
                        };

                        <tr class="@diaColor">
                            <td>
                                <span class="badge bg-light text-dark px-3 py-2 shadow-sm">
                                    @h.Materia
                                </span>
                            </td>
                            <td class="fw-semibold">@h.DiaSemana</td>
                            <td>@h.HoraInicio.ToString(@"hh\:mm")</td>
                            <td>@h.HoraFin.ToString(@"hh\:mm")</td>
                            <td>
                                <span class="badge bg-secondary-subtle text-dark px-3 py-2">
                                    @h.Seccion
                                </span>
                            </td>

                            @if (Context.Session.GetString("Rol") == "Docente" || Context.Session.GetString("Rol") == "Admin")
                            {
                                <td>
                                    <div class="btn-group">
                                        <a href="/Horarios/Editar/@h.Id" class="btn btn-sm btn-outline-primary">
                                            <i class="bi bi-pencil"></i> Editar
                                        </a>
                                        <form method="post" action="/Horarios/Eliminar/@h.Id" style="display:inline;">
                                            <button type="submit" class="btn btn-sm btn-outline-danger"
                                                    onclick="return confirm('¿Seguro que deseas eliminar este horario?');">
                                                <i class="bi bi-trash"></i> Eliminar
                                            </button>
                                        </form>
                                    </div>
                                </td>
                            }
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>

<!-- 🔹 Estilos adicionales -->
<style>
.table thead th {
    font-weight: 600;
    letter-spacing: 0.3px;
}
.table-hover tbody tr:hover {
    background-color: #f5fff7 !important;
    transition: 0.2s;
}
.badge {
    font-size: 0.85rem;
    border-radius: 1rem;
}

/* 🎨 Colores por día */
.bg-lunes { background-color: #e9f7ef !important; }
.bg-martes { background-color: #e8f4fc !important; }
.bg-miercoles { background-color: #fffbe6 !important; }
.bg-jueves { background-color: #fce8f4 !important; }
.bg-viernes { background-color: #f3f0ff !important; }
.bg-otro { background-color: #f9f9f9 !important; }

@@media (max-width: 768px) {
    table thead {
        display: none;
    }
    table, table tbody, table tr, table td {
        display: block;
        width: 100%;
    }
    table tr {
        margin-bottom: 1rem;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    table td {
        padding: 10px 15px;
        text-align: right;
        position: relative;
    }
    table td::before {
        content: attr(data-label);
        position: absolute;
        left: 15px;
        width: 50%;
        font-weight: 600;
        text-align: left;
    }
}
</style>

<!-- Bootstrap Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
