@model ProyectoLuisa.Models.Horario
@{
    bool esEdicion = Model?.Id > 0;
    ViewData["Title"] = esEdicion ? "Editar Horario" : "Crear Nuevo Horario";
}

<h2 class="text-center text-primary fw-bold mb-4">
    @(esEdicion ? "‚úèÔ∏è Editar Horario" : "üïì Registrar Nuevo Horario")
</h2>

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger text-center fw-bold">
        @TempData["Error"]
    </div>
}
@if (TempData["Success"] != null)
{
    <div class="alert alert-success text-center fw-bold">
        @TempData["Success"]
    </div>
}

<form asp-action="@(esEdicion ? "Editar" : "Crear")" method="post" class="row g-3 shadow-sm p-4 bg-light rounded">
    @Html.AntiForgeryToken()
    @if (esEdicion)
    {
        <input type="hidden" asp-for="Id" />
    }

    <div class="col-md-6">
        <label asp-for="Materia" class="form-label fw-bold">Materia</label>
        <input asp-for="Materia" class="form-control" placeholder="Ej: Matem√°ticas, Historia..." required />
        <span asp-validation-for="Materia" class="text-danger"></span>
    </div>

    <div class="col-md-6">
        <label asp-for="Profesor" class="form-label fw-bold">Profesor</label>
        <input asp-for="Profesor" class="form-control" placeholder="Nombre del docente" required />
        <span asp-validation-for="Profesor" class="text-danger"></span>
    </div>

    <div class="col-md-4">
        <label asp-for="DiaSemana" class="form-label fw-bold">D√≠a de la Semana</label>
        <select asp-for="DiaSemana" class="form-select" required>
            <option value="">Seleccione un d√≠a</option>
            <option>Lunes</option>
            <option>Martes</option>
            <option>Mi√©rcoles</option>
            <option>Jueves</option>
            <option>Viernes</option>
            <option>S√°bado</option>
        </select>
        <span asp-validation-for="DiaSemana" class="text-danger"></span>
    </div>

    <div class="col-md-4">
        <label asp-for="HoraInicio" class="form-label fw-bold">Hora de Inicio</label>
        <input asp-for="HoraInicio" type="time" class="form-control" id="horaInicio" required />
        <span asp-validation-for="HoraInicio" class="text-danger"></span>
    </div>

    <div class="col-md-4">
        <label asp-for="HoraFin" class="form-label fw-bold">Hora de Finalizaci√≥n</label>
        <input asp-for="HoraFin" type="time" class="form-control" id="horaFin" required />
        <span asp-validation-for="HoraFin" class="text-danger"></span>
    </div>

    <div class="col-md-4">
        <label asp-for="Aula" class="form-label fw-bold">Aula</label>
        <input asp-for="Aula" class="form-control" placeholder="Ej: Aula 3, Laboratorio, etc." required />
        <span asp-validation-for="Aula" class="text-danger"></span>
    </div>

    <div class="col-md-4">
        <label asp-for="Grupo" class="form-label fw-bold">Grupo</label>
        <input asp-for="Grupo" class="form-control" placeholder="Ej: A, B, C" required />
        <span asp-validation-for="Grupo" class="text-danger"></span>
    </div>

    <div class="col-md-4">
        <label asp-for="Seccion" class="form-label fw-bold">Secci√≥n</label>
        <input asp-for="Seccion" class="form-control" placeholder="Ej: Sec. 1, Ciencias..." />
        <span asp-validation-for="Seccion" class="text-danger"></span>
    </div>

    <div class="col-12 text-center mt-4">
        <button type="submit" class="btn btn-success px-4 fw-bold">
            <i class="bi bi-save"></i> @(esEdicion ? "Guardar Cambios" : "Guardar Horario")
        </button>
        <a asp-action="Index" class="btn btn-secondary px-4 fw-bold">
            <i class="bi bi-arrow-left"></i> Volver
        </a>
    </div>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        // Validaci√≥n visual: solo permite horarios v√°lidos
        document.querySelector("form").addEventListener("submit", function (e) {
            const inicio = document.getElementById("horaInicio").value;
            const fin = document.getElementById("horaFin").value;

            if (!inicio || !fin) return;

            const [h1, m1] = inicio.split(":").map(Number);
            const [h2, m2] = fin.split(":").map(Number);

            const t1 = h1 + m1 / 60;
            const t2 = h2 + m2 / 60;

            const rango1Inicio = 7;
            const rango1Fin = 16.5;
            const rango2Inicio = 17;
            const rango2Fin = 22;

            const esValido = (
                (t1 >= rango1Inicio && t2 <= rango1Fin) ||
                (t1 >= rango2Inicio && t2 <= rango2Fin)
            );

            if (!esValido) {
                e.preventDefault();
                alert("‚ö†Ô∏è Las horas deben estar entre 7:00‚Äì16:30 o 17:00‚Äì22:00.");
            } else if (t1 >= t2) {
                e.preventDefault();
                alert("‚ö†Ô∏è La hora de inicio no puede ser igual o posterior a la hora final.");
            }
        });
    </script>
}
